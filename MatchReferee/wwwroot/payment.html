<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Club Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-light d-flex align-items-center justify-content-center min-vh-100">
    <div class="card shadow p-4" style="max-width:420px;width:100%">
        <h3 class="text-center">Choose Subscription Tier</h3>
        <select id="tier" class="form-select mb-3">
            <option value="1-4">1-4 logins – £20/mo</option>
            <option value="5-9">5-9 logins – £30/mo</option>
            <option value="10+">10+ logins – £50/mo</option>
        </select>
        <button onclick="pay()" class="btn btn-success w-100">Pay with Card</button>
    </div>

    <script type="module">
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
const auth = getAuth();
const stripe = Stripe('{{YOUR_PK}}');   // replace with publishable key from appsettings

window.pay = async () => {
    const user = auth.currentUser;
    const idToken = await user.getIdToken();
    const resp = await fetch('/api/payment/create-session', {
        method:'POST',
        headers:{'Authorization':`Bearer ${idToken}`,'Content-Type':'application/json'},
        body:JSON.stringify({Tier:document.getElementById('tier').value})
    });
    const {SessionId} = await resp.json();
    stripe.redirectToCheckout({sessionId:SessionId});
};
    </script>
</body>
</html>